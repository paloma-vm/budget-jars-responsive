<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Jars</title>
    <link href="dist/output.css" rel="stylesheet">
</head>
<body class="font-sans">
    <div id="container"></div>
    <main class="flex flex-col h-screen justify-between relative">
        <div class="content">
            <div class="flex flex-col sticky top-0 bg-white">
                <header class="">
                    <nav class="">
                        <ul class="flex sm-flex-col gap-5 font-bold text-[#0E2F7C] p-3 bg-green-300 pl-6">
                            <li><a href="#">Home</a></li>
                            <li><a href="form.html">Get Started</a></li>
                            <li><a href="about.html">About</a></li>
                        </ul>
                        <h1 class="text-slate-900 text-center text-3xl font-bold align-middle mt-4 mb-6">Budget Jars</h1>
                    </nav>
                </header>
                <h1 class="text-yellow-400 rotate-12 text-center text-3xl font-bold">Currently Under Renovation! Will Return Soon!</h1>
                <div class="sm:text-lg" id="manage">
                    <form class="flex p-2 flex-col items-center">
                        <div class="py-5">
                            <label>Choose a jar:</label>
                            <select class="options border" id="category">
                             <!-- see script -->
                            </select>
                        </div>
                        <div class="flex items-center">
                            <label for="amt">Amount</label>
                            <input class="border border-slate-700 text-center mx-3" type="number" id="amt">
                            <div class="buttons flex items-center justify-center ">
                                <button class='text-5xl bg-green-300 border border-black rounded-md px-3 mx-3 pt-0 pb-1'type="submit" id="depositButton"> + </button>
                                <button class='text-5xl bg-red-300 border border-black rounded-md px-4 mx-3 pt-0 pb-1'type="submit" id="spendButton"> - </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <!-- ---------------------------------------------------------- -->
            <div class=" container mx-auto flex flex-col justify-center items-center gap-y-5 py-5 sm:flex sm:flex-row sm:space-x-5 sm:items-stretch" id="jars"></div>
            <!-- ---------------------------------------------------------- -->
        </div>
    
        <!-- FOOTER ---------------------------------------------------------- -->
        <footer class="footer text-slate-50 bg-slate-900">
            <ul class="container max-w-screen mx-auto items-center flex justify-between p-4">
                <li>Paloma Valdez-Marsh</li>
                <li>2023</li>
            </ul>
        </footer>
    </main>
    
    
    <script src="main.js" type="module"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script type="module">
        // import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";
        import Jar from './Jar.js'

        const jars = []

        function makeJar(label, startBal, currentBal) {
            const jar = new Jar(label, startBal, currentBal)
            jars.push(jar)
        }

        function initializeJars() {
        /** A function to create the jars */
            //if (localStorage.key('jars')) {
            if (localStorage.getItem('jars')) {
                savedJarsData = JSON.parse(localStorage.getItem('jars'))
                for (let i = 0; i < savedJarsData.length; i++) {
                    const { label, startBal, currentBal } = savedJarsData[i]
                    makeJar(label, parseFloat(startBal), parseFloat(currentBal))
                }
            } else {
                makeJar('Transportation', 500, 25)
                makeJar('Food', 100, 50)
                makeJar('Entertainment', 40, 500)
                makeJar('Clothes/gifts', 0, 37)
                makeJar('Everything else', 0, 300)
                // localStorage.setItem('jars', JSON.stringify(jars))
            }
        } 

        initializeJars()

        // Declare the chart dimensions and margins.
        const marginTop = 20;
        const marginRight = 30;
        const marginBottom = 30;
        const marginLeft = 40;
        const width = 900;
        const height = 400;
        // const width = 640 - (marginLeft + marginRight);
        // const height = 400 - (marginTop + marginBottom);


        // const data = [
        //     {amount: 100, label: 'Transportation'},
        //     {amount: 200, label: 'Food'},
        //     {amount: 300, label: 'Entertainment'},
        //     {amount: 400, label: 'd'},
        //     {amount: 500, label: 'e'}
        //     ]

        // Declare the x (horizontal position) scale.

        const x = d3.scaleBand()
            .domain(jars.map(d => d.label))
            // .range([marginLeft, width + marginLeft])
            .range([marginLeft, width - marginRight]) // help from ChatGPT

            .padding(0.1)

        // Declare the y (vertical position) scale.
        const y = d3.scaleLinear()
            // .domain([0, 500])
            .domain([0, d3.max(jars, d => d.currentBal)]) // changed this for changing max
            .range([height - marginBottom, marginTop])
            // .range([marginTop, height])
            // .range([height, marginTop])


        // Create the SVG container.
        const svg = d3.create("svg")
            .attr("width", width)
            .attr("height", height);

        // Add the x-axis.
        svg.append("g")
            .attr("transform", `translate(0,${height - marginBottom})`)
            .call(d3.axisBottom(x));

        // Add the y-axis.
        svg.append("g")
            .attr("transform", `translate(${marginLeft},0)`)
            .call(d3.axisLeft(y));

        // Append the SVG element.
        const container = d3.select('#container')
        container.append(() => svg.node())

        // ---------- DRAW -------------------------------
        // Select the SVG (root node)
        // bars group (make a group to hold the bars)
        const barGroup = svg.append('g')
        // Make the bars

        barGroup 
            .selectAll('rect')
            .data(jars)
            .enter()
            .append('rect')
            .attr('class', 'bar')
            .attr('x', (d, i) => x(d.label))
            .attr('y', d => y(d.currentBal))
            .attr('width', x.bandwidth())
            .attr('height', d => height - marginBottom -y(d.currentBal))

    </script>
</body>
</html>